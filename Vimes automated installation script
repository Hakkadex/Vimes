#!/bin/bash

# Create and populate the Vimes.py file in the user's home directory
cat << 'EOF' > ~/Vimes.py
#!/usr/bin/env python3

import sys
import requests
from bs4 import BeautifulSoup
import urllib.parse

SEARCH_ENGINES = {
    'Google': 'https://www.google.com/search',
}

SEARCH_TERMS = [
    'stabbing', 'knife attack', 'robbery', 'robbers', 'man robbed', 
    'woman robbed', 'murder', 'man murdered', 'woman murdered', 
    'gang attack', 'gang fight', 'gang members'
]

def perform_search(query):
    """Perform a search on Google."""
    headlines = []

    for term in SEARCH_TERMS:
        search_query = f"{query} {term}"
        headers = {
            'User-Agent': 'Vimes CLI Tool'
        }
        params = {'q': urllib.parse.quote(search_query)}

        try:
            response = requests.get(SEARCH_ENGINES['Google'], headers=headers, params=params)
            response.raise_for_status()
            
            soup = BeautifulSoup(response.text, 'html.parser')
            for item in soup.find_all('h3'):
                title = item.get_text()
                parent_a = item.find_parent('a')
                if parent_a and parent_a.has_attr('href'):
                    url = parent_a['href']
                else:
                    url = 'No URL available'
                
                headlines.append({'title': title, 'url': url})

        except requests.exceptions.RequestException as e:
            print(f"An error occurred while querying Google: {e}")

    return headlines

def display_results(results):
    """Display search results in the terminal."""
    if not results:
        print("No results found.")
        return

    for result in results:
        print(f"Title: {result['title']}")
        print(f"URL: {result['url']}\n")
        print("-" * 80)

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: vimesget <location>")
        sys.exit(1)

    location = sys.argv[1]

    if location:
        results = perform_search(location)
        display_results(results)
EOF

# Make the Vimes.py file executable
chmod +x ~/Vimes.py

# Create a symlink to make the command available in the PATH
ln -sf ~/Vimes.py /usr/local/bin/vimesget

echo "Installation complete. You can now use the 'vimesget' command from anywhere."
